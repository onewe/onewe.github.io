I"œ!<h1 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h1>

<p>æœ‰ç°æˆçš„Cåº“ä¸ºä»€ä¹ˆè¦è‡ªå·±é€ è½®å­å‘¢?æˆ‘å‘ç°å¤§å®¶å¯¹é€ è½®å­æƒ…æœ‰ç‹¬é’Ÿå‘€,æ‰€ä»¥æˆ‘ä¹Ÿæ¥è¯•ä¸€è¯•,å…å¾—è¢«Cåœˆé‡Œé¢çš„äººæ’æŒ¤.</p>

<h1 id="äºŒä¸Šä»£ç ">äºŒã€ä¸Šä»£ç </h1>

<ol>
  <li>
    <p>å¤´æ–‡ä»¶logger.h</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef LOGGER_H_
#define LOGGER_H_
</span>   
<span class="cp">#include &lt;Windows.h&gt;
#include &lt;tchar.h&gt;
#include &lt;stdio.h&gt;
</span>   
<span class="cp">#if !defined(LOG_TAG)
#define LOG_TAG          L"NO_TAG"
#endif
</span>   
<span class="cp">#include &lt;stdarg.h&gt;
#include &lt;time.h&gt;
</span>   
<span class="cp">#define __STR2WSTR(str) L##str
#define _STR2WSTR(str) __STR2WSTR(str)
#define __FUNCTIONW__ _STR2WSTR(__FUNCTION__)
</span>   
   
<span class="cm">/*æ—¥å¿—çº§åˆ«æšä¸¾ç±»å‹*/</span>
<span class="k">enum</span> <span class="n">Level</span> <span class="p">{</span> <span class="n">L_DEBUG</span><span class="p">,</span> <span class="n">L_INFO</span><span class="p">,</span> <span class="n">L_ERROR</span> <span class="p">};</span>
<span class="cm">/*æ‰“å°debugçº§åˆ«çš„æ—¥å¿—*/</span>
<span class="cp">#define log_d(...) PrintLog(L_DEBUG,LOG_TAG,__FUNCTIONW__,__LINE__,__VA_ARGS__) 
</span><span class="cm">/*æ‰“å°infoçº§åˆ«çš„æ—¥å¿—*/</span>
<span class="cp">#define log_i(...) PrintLog(L_INFO,LOG_TAG,__FUNCTIONW__,__LINE__,__VA_ARGS__)
</span><span class="cm">/*æ‰“å°errorçº§åˆ«çš„æ—¥å¿—*/</span>
<span class="cp">#define log_e(...) PrintLog(L_ERROR,LOG_TAG,__FUNCTIONW__,__LINE__,__VA_ARGS__)
</span>   
<span class="cp">#endif // LOGGER_H
</span>   
   
<span class="c1">//æ‰“å°æ—¥å¿—</span>
<span class="kt">void</span> <span class="nf">PrintLog</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span><span class="n">TCHAR</span> <span class="o">*</span> <span class="n">tag</span><span class="p">,</span><span class="n">TCHAR</span> <span class="o">*</span> <span class="n">func</span><span class="p">,</span><span class="kt">long</span> <span class="n">line</span><span class="p">,</span><span class="n">TCHAR</span> <span class="o">*</span> <span class="n">format</span><span class="p">,...);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>cæ–‡ä»¶</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "Logger.h"
</span>   
<span class="c1">//æ—¥å¿—çš„æœ€å¤§é•¿åº¦</span>
<span class="cp">#define LOG_MAX_BUF_SIZE 1024
</span><span class="cm">/*æ—¶é—´å­—ç¬¦ä¸²æœ€å¤§64*/</span>
<span class="cp">#define TIME_BUFLEN 64
#define TIME_FORMAT L"%Y-%m-%d %H:%M:%S"
</span><span class="cm">/*æ—¥å¿—å‰é¢éƒ¨åˆ†çš„æ ¼å¼ [æ—¶é—´]  æ—¥å¿—çº§åˆ«  æ ‡ç­¾*/</span>
<span class="cp">#define LOG_FORMAT L"[%20s %s] %s/%s %s:%ld:   "
</span>   
<span class="k">static</span> <span class="n">TCHAR</span> <span class="o">*</span> <span class="n">leveInfo</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">L"D"</span><span class="p">,</span><span class="s">L"I"</span><span class="p">,</span><span class="s">L"E"</span> <span class="p">};</span>
<span class="k">static</span> <span class="n">TCHAR</span> <span class="n">logBuf</span><span class="p">[</span><span class="n">LOG_MAX_BUF_SIZE</span><span class="p">];</span>
   
   
<span class="c1">//è·å–å½“å‰ç³»ç»Ÿæ—¶é—´</span>
<span class="n">TCHAR</span><span class="o">*</span> <span class="nf">GetTime</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">static</span> <span class="n">TCHAR</span> <span class="n">timeStr</span><span class="p">[</span><span class="n">TIME_BUFLEN</span><span class="p">];</span>
	<span class="kt">time_t</span> <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span> <span class="n">local</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
	<span class="n">_tcsftime</span><span class="p">(</span><span class="n">timeStr</span><span class="p">,</span> <span class="n">TIME_BUFLEN</span><span class="p">,</span> <span class="n">TIME_FORMAT</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">timeStr</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//è·å–è¿›ç¨‹ID</span>
<span class="n">TCHAR</span> <span class="o">*</span><span class="nf">GetPID</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">static</span> <span class="n">TCHAR</span> <span class="n">pidBuf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="kt">long</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">GetCurrentProcessId</span><span class="p">();</span>
	<span class="n">_stprintf</span><span class="p">(</span><span class="n">pidBuf</span><span class="p">,</span> <span class="s">L"PID:%04ld"</span><span class="p">,</span> <span class="n">GetCurrentProcessId</span><span class="p">());</span>
   
	<span class="k">return</span> <span class="n">pidBuf</span><span class="p">;</span>
<span class="p">}</span>
   
   
   
<span class="c1">//æ‰“å°æ—¥å¿—</span>
<span class="kt">void</span> <span class="nf">PrintLog</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="n">TCHAR</span> <span class="o">*</span> <span class="n">tag</span><span class="p">,</span> <span class="n">TCHAR</span> <span class="o">*</span> <span class="n">func</span><span class="p">,</span> <span class="kt">long</span> <span class="n">line</span><span class="p">,</span> <span class="n">TCHAR</span> <span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
	<span class="c1">//æ—¶é—´</span>
	<span class="n">TCHAR</span><span class="o">*</span> <span class="n">timeStr</span> <span class="o">=</span> <span class="n">GetTime</span><span class="p">();</span>
	<span class="c1">//æ—¥å¿—ç­‰çº§</span>
	<span class="n">TCHAR</span><span class="o">*</span> <span class="n">levelStr</span> <span class="o">=</span> <span class="n">leveInfo</span><span class="p">[</span><span class="n">level</span><span class="p">];</span>
	<span class="n">TCHAR</span><span class="o">*</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">GetPID</span><span class="p">();</span>
	<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">_stprintf</span><span class="p">(</span><span class="n">logBuf</span><span class="p">,</span> <span class="n">LOG_FORMAT</span><span class="p">,</span><span class="n">timeStr</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">levelStr</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span><span class="n">line</span><span class="p">);</span>
	<span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
	<span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="n">format</span><span class="p">);</span>
	<span class="n">_vsntprintf</span><span class="p">(</span><span class="n">logBuf</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span> <span class="n">LOG_MAX_BUF_SIZE</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span><span class="n">args</span><span class="p">);</span>
	<span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
	<span class="c1">//æ‰“å°æ—¥å¿—,è¿™ä¸ªFILE è‡ªå·±å®šä¹‰,å¯ä»¥æ˜¯console,ä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶</span>
	<span class="n">_ftprintf</span><span class="p">(</span><span class="kt">FILE</span><span class="p">,</span><span class="n">logBuf</span><span class="p">);</span>
   	
<span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>æ³¨æ„åœ¨windowså¹³å°ä¸Š,è¾“å‡ºä¸­æ–‡åˆ°æ–‡ä»¶é‡Œé¢,å¿…é¡»æ˜¯å®½å­—ç¬¦,å¦åˆ™çœ‹ä¸åˆ°è¾“å‡ºå†…å®¹,æˆ–è€…æ˜¯ä¹±ç </li>
    </ul>
  </li>
</ol>
:ET