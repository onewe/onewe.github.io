I"3<h1 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h1>

<p>é¡¹ç›®æ‰“å°æ—¥å¿—æ˜¯ä½¿ç”¨AOPå®ç°çš„,æŠŠcontrolleræ–¹æ³•ä¸Šçš„å‚æ•°å’Œè¿”å›å€¼å…¨éƒ¨ä½¿ç”¨fastjsonè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²æ‰“å°å‡ºæ¥,æ–¹ä¾¿è§‚å¯Ÿæ–¹æ³•è°ƒç”¨æƒ…å†µ.æœ€è¿‘åŒäº‹é‡åˆ°äº†ä¸€ä¸ªåœ¨æ‰“å°æ—¥å¿—çš„æ—¶å€™,fastjson åºåˆ—åŒ–çš„å¼‚å¸¸,è¿™ä¸ªå¼‚å¸¸ä¸å½±å“ä¸šåŠ¡é€»è¾‘,ä½œä¸ºä¸€ä¸ªæœ‰å¼ºè¿«ç—‡çš„äºº,å§‹ç»ˆæ˜¯è§‰å¾—æœ‰é—®é¢˜çš„,äºæ˜¯è·Ÿç€é”™è¯¯ä¿¡æ¯å°±æ‰¾äº†ä¸‹å».</p>

<h1 id="äºŒç—‡çŠ¶">äºŒã€ç—‡çŠ¶</h1>

<p>çœ‹çœ‹å¼‚å¸¸ä¿¡æ¯å§!</p>

<p><img src="https://itinfo.oss-cn-hongkong.aliyuncs.com/img/1CfMpX.jpg" alt="1CfMpX" /></p>

<p>ä»å¼‚å¸¸çš„ä¿¡æ¯å¯ä»¥çœ‹å‡º,åœ¨fastjsonæŠŠå¯¹è±¡è½¬jsonå­—ç¬¦ä¸²çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜,è²Œä¼¼ä»è¿™ä¸ªå›¾ç‰‡ä¸­çœ‹ä¸å‡ºå•¥é—®é¢˜,è¯¥å›¾ç‰‡ä¸‹é¢è¿˜æœ‰ä¸€æ®µå¼‚å¸¸ä¿¡æ¯,å¦‚ä¸‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.lang.IllegalStateException: It is illegal to call this method if the current request is not in asynchronous mode (i.e. isAsyncStarted() returns false)
at org.apache.catalina.connector.Request.getAsyncContext(Request.java:1740)
at org.apache.catalina.connector.RequestFacade.getAsyncContext(RequestFacade.java:1047)
at com.alibaba.fastjson.serializer.ASMSerializer_1_RequestFacade.write(Unknown Source)
at com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:280)
at com.alibaba.fastjson.JSON.toJSONString(JSON.java:673)
at com.alibaba.fastjson.JSON.toJSONString(JSON.java:611)
at com.alibaba.fastjson.JSON.toJSONString(JSON.java:576)
at com.me.Aspect.LoggerAspect.After(LoggerAspect.java:36)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:620)
</code></pre></div></div>

<h1 id="ä¸‰åˆ†æ">ä¸‰ã€åˆ†æ</h1>

<p>â€‹	ä¸Šé¢è¿™æ®µä¿¡æ¯å¯ä»¥çœ‹å‡º,è°ƒç”¨getAsyncContextæ–¹æ³•å‡ºç°äº†é—®é¢˜.è¡¨ç¤ºå½“å‰è¿™ä¸ªrequestå¯¹è±¡ä¸æ˜¯å¼‚æ­¥æ¨¡å¼çš„,æ‰€ä»¥ä¸èƒ½è°ƒç”¨<code class="language-plaintext highlighter-rouge">getAsyncContext</code>è¿™ä¸ªæ–¹æ³•.è¿™ä¸ªrequestçš„å¼‚æ­¥æ¨¡å¼,æ˜¯servlet3ä¸­çš„ä¸€ä¸ªæ–°ç‰¹æ€§,å¯ä»¥ä½¿ç”¨æ³¨è§£æˆ–è€…é…ç½®xmlçš„æ–¹å¼è¿›è¡Œå¼€å¯,ä¸€èˆ¬ç”¨äºå¼‚æ­¥è¯·æ±‚,è¿™ä¸ªrequestçš„å¼‚æ­¥æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯,å°±ä¸å¤šè®ºè¿°äº†.å›åˆ°é—®é¢˜ä¸­æ¥,fastjsonåºåˆ—åŒ–å‡ºé”™,å‡ºé”™çš„åŸå› æ˜¯fastjsonè°ƒç”¨äº†<code class="language-plaintext highlighter-rouge">getAsyncContext</code>æ–¹æ³•,ç”±äºrequestä¸æ˜¯å¼‚æ­¥æ¨¡å¼,æ‰€ä»¥æŠ¥é”™äº†,é‚£ä¹ˆç»“æœå°±æ˜¯fastjsonåºåˆ—åŒ–å‡ºé”™äº†.</p>

<p>â€‹		å†çœ‹ä¸€ä¸‹å¼‚å¸¸ä¿¡æ¯,æŒ‰ç…§æ‰“å°çš„æ ˆä¿¡æ¯æ¥çœ‹,æ˜¯<code class="language-plaintext highlighter-rouge">RequestFacade</code>å¯¹è±¡ä¸­çš„<code class="language-plaintext highlighter-rouge">getAsyncContext</code>æ–¹æ³•è¢«è°ƒç”¨äº†,ä½†æ˜¯å·¥ç¨‹é‡Œé¢å¹¶æ²¡ç”¨ç”¨åˆ°<code class="language-plaintext highlighter-rouge">RequestFacade</code>å¯¹è±¡å‘€,æŸ¥çœ‹<code class="language-plaintext highlighter-rouge">RequestFacade</code>ç±»çš„æºç è¿‡åå‘ç°<code class="language-plaintext highlighter-rouge">RequestFacade</code>å…¶å®æ˜¯<code class="language-plaintext highlighter-rouge">HttpServletRequest</code>çš„ä¸€ä¸ªå…·ä½“å®ç°.é‚£ä¹ˆé—®é¢˜å°±å®šä½åˆ°äº†,fastjsonæŠŠ<code class="language-plaintext highlighter-rouge">HttpServletRequest</code>åºåˆ—åŒ–äº†,åªè¦æŠŠæ–¹æ³•ä¸Šçš„<code class="language-plaintext highlighter-rouge">HttpServletRequest</code> å‚æ•°å»æ‰å°±å¯ä»¥äº†.</p>

<p><img src="https://itinfo.oss-cn-hongkong.aliyuncs.com/img/MZ7BAI.jpg" alt="MZ7BAI" /></p>

<h1 id="å››æ€»ç»“">å››ã€æ€»ç»“</h1>

<p>æœ‰æ—¶å€™é—®é¢˜å¾ˆç®€å•,å¯èƒ½åªæ˜¯ä½ æ²¡é‡åˆ°è¿‡è€Œå·²,å¤šåšè®°å½•,ç§¯ç´¯ç»éªŒ!</p>

:ET