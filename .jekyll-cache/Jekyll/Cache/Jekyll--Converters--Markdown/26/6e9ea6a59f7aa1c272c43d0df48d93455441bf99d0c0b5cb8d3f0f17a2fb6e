I"èj<h1 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h1>

<p>â€‹	é€šè¿‡å‰é¢å¤§æ‰¹é‡çš„å·¥ä½œ,ç»ˆäºè¦åˆ°æ³¨å†ŒBeanDefinitionHolderè¿™ä¸€æ­¥äº†.å½“ç„¶è¿˜æ˜¯é€šè¿‡ä¸€ä¸‹ä»£ç ä½œä¸ºå…¥å£è¿›è¡Œåˆ†æ.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">processBeanDefinition</span><span class="o">(</span><span class="nc">Element</span> <span class="n">ele</span><span class="o">,</span> <span class="nc">BeanDefinitionParserDelegate</span> <span class="n">delegate</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// è§£æxmlå…ƒç´ </span>
		<span class="nc">BeanDefinitionHolder</span> <span class="n">bdHolder</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">.</span><span class="na">parseBeanDefinitionElement</span><span class="o">(</span><span class="n">ele</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">bdHolder</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// è£…é¥°bean</span>
			<span class="n">bdHolder</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">.</span><span class="na">decorateBeanDefinitionIfRequired</span><span class="o">(</span><span class="n">ele</span><span class="o">,</span> <span class="n">bdHolder</span><span class="o">);</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="c1">// Register the final decorated instance.</span>
				<span class="c1">// æ³¨å†Œbeanåˆ°å®¹å™¨ä¸­</span>
				<span class="nc">BeanDefinitionReaderUtils</span><span class="o">.</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">bdHolder</span><span class="o">,</span> <span class="n">getReaderContext</span><span class="o">().</span><span class="na">getRegistry</span><span class="o">());</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">BeanDefinitionStoreException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">getReaderContext</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="s">"Failed to register bean definition with name '"</span> <span class="o">+</span>
						<span class="n">bdHolder</span><span class="o">.</span><span class="na">getBeanName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">,</span> <span class="n">ele</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="c1">// Send registration event.</span>
			<span class="c1">// å‘é€äº‹ä»¶</span>
			<span class="n">getReaderContext</span><span class="o">().</span><span class="na">fireComponentRegistered</span><span class="o">(</span><span class="k">new</span> <span class="nc">BeanComponentDefinition</span><span class="o">(</span><span class="n">bdHolder</span><span class="o">));</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>â€‹	è§£æã€è£…é¥°éƒ½å·²ç»è®°å½•äº†,è§£ææ¥çš„é‡ç‚¹å°±æ˜¯<code class="language-plaintext highlighter-rouge">BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());</code>è¿™å¥ä»£ç äº†.</p>

<h1 id="äºŒåˆ†æ">äºŒã€åˆ†æ</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">registerBeanDefinition</span><span class="o">(</span>
			<span class="nc">BeanDefinitionHolder</span> <span class="n">definitionHolder</span><span class="o">,</span> <span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">BeanDefinitionStoreException</span> <span class="o">{</span>
		<span class="c1">// æ³¨å†Œ bean</span>
		<span class="c1">// Register bean definition under primary name.</span>
		<span class="c1">// è·å– bean çš„åç§°</span>
		<span class="nc">String</span> <span class="n">beanName</span> <span class="o">=</span> <span class="n">definitionHolder</span><span class="o">.</span><span class="na">getBeanName</span><span class="o">();</span>
		<span class="c1">// æ³¨å†Œ</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">definitionHolder</span><span class="o">.</span><span class="na">getBeanDefinition</span><span class="o">());</span>

		<span class="c1">//æ³¨å†Œ bean çš„æ‰€æœ‰åˆ«å</span>
		<span class="c1">// Register aliases for bean name, if any.</span>
		<span class="nc">String</span><span class="o">[]</span> <span class="n">aliases</span> <span class="o">=</span> <span class="n">definitionHolder</span><span class="o">.</span><span class="na">getAliases</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">aliases</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">alias</span> <span class="o">:</span> <span class="n">aliases</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">registry</span><span class="o">.</span><span class="na">registerAlias</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">alias</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ol>
  <li>é€šè¿‡beançš„åç§°è¿›è¡Œæ³¨å†Œ</li>
  <li>é€šè¿‡beançš„åˆ«åè¿›è¡Œæ³¨å†Œ</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistry</code>è¿™ä¸ªå¯¹è±¡æ˜¯é€šè¿‡<code class="language-plaintext highlighter-rouge">XmlReaderContext</code>ä¸­è·å–çš„.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// XmlReaderContext</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="nc">BeanDefinitionRegistry</span> <span class="nf">getRegistry</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">reader</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">();</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>â€‹	è€Œè¿™ä¸ªreaderåˆ™æ˜¯<code class="language-plaintext highlighter-rouge">XmlBeanDefinitionReader</code>,<code class="language-plaintext highlighter-rouge">registry</code>å¯¹è±¡åˆ™é€šè¿‡<code class="language-plaintext highlighter-rouge">XmlBeanDefinitionReader</code>çš„æ„é€ æ–¹æ³•ä¼ å…¥è¿›æ¥,å®é™…ä¸Šè¿™ä¸ª<code class="language-plaintext highlighter-rouge">registry</code>å¯¹è±¡å°±æ˜¯<code class="language-plaintext highlighter-rouge">XmlBeanFactory</code>æˆ–è€…è¯´æ˜¯<code class="language-plaintext highlighter-rouge">DefaultListableBeanFactory</code>,å› ä¸ºè¿™ä¸¤ä¸ªæœ‰ç»§æ‰¿å…³ç³».</p>

<p>â€‹	<img src="https://itinfo.oss-cn-hongkong.aliyuncs.com/img/k5xTOv.jpg" alt="k5xTOv" /></p>

<h2 id="21-registerbeandefinition">2.1 registerBeanDefinition</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// DefaultListableBeanFactory</span>
<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerBeanDefinition</span><span class="o">(</span><span class="nc">String</span> <span class="n">beanName</span><span class="o">,</span> <span class="nc">BeanDefinition</span> <span class="n">beanDefinition</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">BeanDefinitionStoreException</span> <span class="o">{</span>

		<span class="nc">Assert</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="s">"Bean name must not be empty"</span><span class="o">);</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">beanDefinition</span><span class="o">,</span> <span class="s">"BeanDefinition must not be null"</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">beanDefinition</span> <span class="k">instanceof</span> <span class="nc">AbstractBeanDefinition</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="c1">// æ ¡éªŒ bean çš„å®šä¹‰æ˜¯å¦åˆæ³•</span>
				<span class="o">((</span><span class="nc">AbstractBeanDefinition</span><span class="o">)</span> <span class="n">beanDefinition</span><span class="o">).</span><span class="na">validate</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">BeanDefinitionValidationException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">BeanDefinitionStoreException</span><span class="o">(</span><span class="n">beanDefinition</span><span class="o">.</span><span class="na">getResourceDescription</span><span class="o">(),</span> <span class="n">beanName</span><span class="o">,</span>
						<span class="s">"Validation of bean definition failed"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="c1">// ä»ç¼“å­˜ä¸­å–å‡º BeanDefinition</span>
		<span class="nc">BeanDefinition</span> <span class="n">existingDefinition</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
		<span class="c1">// bean å·²è¢«æ³¨å†Œè¿‡</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">existingDefinition</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// å¦‚æœä¸å…è®¸é‡å¤æ³¨å†Œåˆ™æŠ›å‡ºå¼‚å¸¸</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">isAllowBeanDefinitionOverriding</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">BeanDefinitionOverrideException</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">,</span> <span class="n">existingDefinition</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">existingDefinition</span><span class="o">.</span><span class="na">getRole</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">beanDefinition</span><span class="o">.</span><span class="na">getRole</span><span class="o">())</span> <span class="o">{</span>
				<span class="c1">// e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Overriding user-defined bean definition for bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"' with a framework-generated bean definition: replacing ["</span> <span class="o">+</span>
							<span class="n">existingDefinition</span> <span class="o">+</span> <span class="s">"] with ["</span> <span class="o">+</span> <span class="n">beanDefinition</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="nf">if</span> <span class="o">(!</span><span class="n">beanDefinition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">existingDefinition</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Overriding bean definition for bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"' with a different definition: replacing ["</span> <span class="o">+</span> <span class="n">existingDefinition</span> <span class="o">+</span>
							<span class="s">"] with ["</span> <span class="o">+</span> <span class="n">beanDefinition</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Overriding bean definition for bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"' with an equivalent definition: replacing ["</span> <span class="o">+</span> <span class="n">existingDefinition</span> <span class="o">+</span>
							<span class="s">"] with ["</span> <span class="o">+</span> <span class="n">beanDefinition</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="c1">// æ”¾å…¥åˆ° map ä¸­</span>
			<span class="c1">// è¦†ç›–</span>
			<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="c1">// åˆ¤æ–­æ˜¯å¦æœ‰åˆ›å»ºä¸­çš„bean</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">hasBeanCreationStarted</span><span class="o">())</span> <span class="o">{</span>
				<span class="c1">// Cannot modify startup-time collection elements anymore (for stable iteration)</span>
				<span class="c1">// åŠ é”</span>
				<span class="c1">// ä¸èƒ½ä¿®æ”¹å¯åŠ¨æ—¶çš„é›†åˆ,éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªé›†åˆ</span>
				<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">)</span> <span class="o">{</span>
					<span class="c1">// æ”¾å…¥mapä¸­</span>
					<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">);</span>
					<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">updatedDefinitions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
					<span class="n">updatedDefinitions</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span><span class="o">);</span>
					<span class="n">updatedDefinitions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
					<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span> <span class="o">=</span> <span class="n">updatedDefinitions</span><span class="o">;</span>
					<span class="c1">// å¦‚æœè¿™ä¸ªå·²ç» bean åœ¨å­˜åœ¨ åˆ™ç§»é™¤</span>
					<span class="n">removeManualSingletonName</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="c1">// Still in startup registration phase</span>
				<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
        <span class="c1">// å¦‚æœè¿™ä¸ªå·²ç» bean åœ¨å­˜åœ¨ åˆ™ç§»é™¤</span>
				<span class="n">removeManualSingletonName</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">this</span><span class="o">.</span><span class="na">frozenBeanDefinitionNames</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="c1">//æ³¨å†ŒæˆåŠŸ,å¦‚æœæ˜¯é‡å¤æ³¨å†Œçš„åˆ™é”€æ¯ä¹‹å‰æ³¨å†Œçš„bean</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">existingDefinition</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">containsSingleton</span><span class="o">(</span><span class="n">beanName</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">resetBeanDefinition</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>â€‹	è¿™ä¸ªé˜¶æ®µå‘¢,beanéƒ½è¿˜æ²¡å¼€å§‹åˆ›å»º,éƒ½æ˜¯åœ¨åšè§£æ,æ³¨å†Œä¹‹ç±»çš„äº‹æƒ…,æ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªåˆ¤æ–­çœ‹èµ·æ¥æ¯”è¾ƒè¿·æƒ‘<code class="language-plaintext highlighter-rouge">hasBeanCreationStarted</code>.æˆ–è®¸åé¢æ‰ä¼šçŸ¥é“è¿™ä¸ªåˆ¤æ–­æ¡ä»¶æœ‰å•¥ç”¨å§.</p>

<ol>
  <li>éªŒè¯<code class="language-plaintext highlighter-rouge">beanDefinition</code>æ˜¯å¦åˆæ³•</li>
</ol>

 	2. åˆ¤æ–­beanæ˜¯å¦è¢«æ³¨å†Œè¿‡,å¦‚æœä¸å…è®¸é‡å¤æ³¨å†Œåˆ™æŠ›å‡ºå¼‚å¸¸
 	3. å¦‚æœå…è®¸é‡å¤æ³¨å†Œåˆ™æ”¾å…¥<code class="language-plaintext highlighter-rouge">beanDefinitionMap</code>è¿™ä¸ªmapé›†åˆä¸­
 	4. å¦‚æœè¯¥<code class="language-plaintext highlighter-rouge">beanDefinition</code>æœªè¢«æ³¨å†Œè¿‡,åˆ™æ·»åŠ æ˜ å°„åˆ°<code class="language-plaintext highlighter-rouge">beanDefinitionMap</code>ä¸­å»å’Œ<code class="language-plaintext highlighter-rouge">beanDefinitionNames</code>é›†åˆä¸­å».
 	5. æ³¨å†ŒæˆåŠŸ,å¦‚æœæ˜¯é‡å¤æ³¨å†Œçš„åˆ™é”€æ¯ä¹‹å‰æ³¨å†Œçš„bean

<h2 id="22-registeralias">2.2 registerAlias</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SimpleAliasRegistry</span>
<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerAlias</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">alias</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="s">"'name' must not be empty"</span><span class="o">);</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">alias</span><span class="o">,</span> <span class="s">"'alias' must not be empty"</span><span class="o">);</span>
		<span class="c1">// åŠ é” å¹¶å‘æ§åˆ¶</span>
		<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// åˆ¤æ–­ bean åç§°æ˜¯å¦ä¸åˆ«åç›¸åŒ,å¦‚æœç›¸åŒåˆ™å¿½ç•¥</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">alias</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
				<span class="c1">// ç§»é™¤åˆ«å</span>
				<span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">alias</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Alias definition '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' ignored since it points to same name"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="c1">// åˆ¤æ–­åˆ«åæ˜¯å¦å·²å­˜åœ¨</span>
				<span class="nc">String</span> <span class="n">registeredName</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">alias</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">registeredName</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="c1">// å¦‚æœåˆ«åå¯¹åº”çš„beançš„åç§°ä¸nameç›¸åŒåˆ™å¿½ç•¥</span>
					<span class="k">if</span> <span class="o">(</span><span class="n">registeredName</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
						<span class="c1">// An existing alias - no need to re-register</span>
						<span class="k">return</span><span class="o">;</span>
					<span class="o">}</span>
					<span class="c1">// æ˜¯å¦å…è®¸è¦†ç›–,å¦‚æœä¸å…è®¸åˆ™æŠ¥é”™</span>
					<span class="k">if</span> <span class="o">(!</span><span class="n">allowAliasOverriding</span><span class="o">())</span> <span class="o">{</span>
						<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"Cannot define alias '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' for name '"</span> <span class="o">+</span>
								<span class="n">name</span> <span class="o">+</span> <span class="s">"': It is already registered for name '"</span> <span class="o">+</span> <span class="n">registeredName</span> <span class="o">+</span> <span class="s">"'."</span><span class="o">);</span>
					<span class="o">}</span>
					<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
						<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Overriding alias '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' definition for registered name '"</span> <span class="o">+</span>
								<span class="n">registeredName</span> <span class="o">+</span> <span class="s">"' with new target name '"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">);</span>
					<span class="o">}</span>
				<span class="o">}</span>
				<span class="c1">//æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨åˆ«å ä¾‹å¦‚:A-B C-B A-C</span>
				<span class="n">checkForAliasCircle</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">alias</span><span class="o">);</span>
				<span class="c1">//æ˜ å°„åˆ«åå’Œåç§°åˆ°mapä¸­</span>
				<span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">alias</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Alias definition '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' registered for name '"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ol>
  <li>åˆ¤æ–­åˆ«åæ˜¯å¦ä¸beanåç§°æ˜¯å¦ç›¸åŒ</li>
  <li>å¦‚æœç›¸åŒåˆ™ç§»é™¤åˆ«å</li>
  <li>åˆ¤æ–­åˆ«åæ˜¯å¦å·²ç»å­˜åœ¨</li>
  <li>å¦‚æœä¸å­˜åœ¨æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨</li>
  <li>æ˜ å°„åˆ«å</li>
</ol>

<p>â€‹	è¿™é‡Œæ£€æµ‹æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨æ¯”è¾ƒæœ‰æ„æ€,ä¹‹å‰æ–‡ç« åº”è¯¥è®°å½•åˆ°äº†è¿™å—å„¿çš„é€»è¾‘.</p>

<h1 id="ä¸‰å°ç»“">ä¸‰ã€å°ç»“</h1>

<p>â€‹	beançš„è§£æä¸æ³¨å†Œå·²ç»åˆ†æå®Œäº†,æ¥ä¸‹æ¥å°±æ˜¯é‡å¤´æˆäº†,ç»ˆäºè¦çœ‹çœ‹ spring æ˜¯æ€ä¹ˆæ ¹æ®<code class="language-plaintext highlighter-rouge">BeanDefinition</code>æ¥åˆ›å»ºbeanå¯¹è±¡.</p>
:ET