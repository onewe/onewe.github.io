<h1 id="一前言">一、前言</h1>

<p>最近由于公司业务需求,只能在win上进行编译c库,这就郁闷了,鄙人可是中毒linux用户呀,这样不是要搞死我嘛.于是想到了在kvm上安装一个win来满足开发的需求.kvm相比openVZ 和 VM 等虚拟化技术还算是性能较高的.</p>

<h1 id="二安装前准备">二、安装前准备</h1>

<ol>
  <li>安装好kvm</li>
  <li>提前下载好win的镜像</li>
  <li>提前下载好virtio驱动包,推荐在fedora的网站下载,鄙人选用的是0.1.126版本 ,<a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.126-2/">下载地址</a></li>
</ol>

<h1 id="三安装">三、安装</h1>

<ol>
  <li>
    <p>把之前下载好的win镜像和virtio驱动包上传到kvm主机上去</p>
  </li>
  <li>
    <p>创建一个虚拟主机</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virt-install <span class="se">\</span>
<span class="nt">--name</span> win7 <span class="se">\ </span><span class="c"># 主机名称</span>
<span class="nt">--memory</span> 2048 <span class="se">\ </span><span class="c">#主机内存</span>
<span class="nt">--vcpus</span> <span class="nv">sockets</span><span class="o">=</span>1,cores<span class="o">=</span>1,threads<span class="o">=</span>2 <span class="se">\ </span><span class="c">#主机cpu 1个cpu 1核 2线程</span>
<span class="nt">--cdrom</span><span class="o">=</span>/ios/cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso <span class="se">\ </span><span class="c">#安装镜像</span>
<span class="nt">--os-variant</span><span class="o">=</span>win7 <span class="se">\ </span><span class="c">#系统类型</span>
<span class="nt">--disk</span> /vhost/win7.qcow2,bus<span class="o">=</span>virtio,size<span class="o">=</span>40 <span class="se">\ </span><span class="c">#创建磁盘</span>
<span class="nt">--disk</span> /ios/virtio-win-0.1.126_amd64.vfd,device<span class="o">=</span>floppy <span class="se">\ </span><span class="c">#挂载软盘</span>
<span class="nt">--network</span> <span class="nv">bridge</span><span class="o">=</span>br0,model<span class="o">=</span>virtio <span class="se">\ </span><span class="c">#指定网卡</span>
<span class="nt">--graphics</span> vnc,password<span class="o">=</span>Passw0rd,port<span class="o">=</span>5910 <span class="se">\ </span><span class="c">#启用vnc</span>
<span class="nt">--hvm</span> <span class="se">\</span>
<span class="nt">--virt-type</span> kvm
</code></pre></div>    </div>
  </li>
  <li>
    <p>运行以上命令之后就开始创建虚拟机了.<img src="https://gitee.com/oneww/onew_image/raw/master/kvm-install-win-command.png" alt="images" /></p>

    <p>以上的错误信息请忽略,不会产生太大的影响.</p>
  </li>
  <li>
    <p>接下来连接vnc进行图形化安装,当然可以使用webVritMgr进行图形化安装.进行vnc连接的话要使用隧道映射到本地的端口,因为5910顿口只能在宿主机上访问<code class="language-plaintext highlighter-rouge">ssh -L 5910:127.0.0.1:5910 root@192.168.3.110</code>把端口映射到本地.</p>
  </li>
  <li>
    <p>连接vnc进行安装<img src="https://gitee.com/oneww/onew_image/raw/master/kvm-win7-GUI.png" alt="images" /></p>

    <p>点击浏览按钮,加载刚才我们下载好的virtio驱动包<img src="https://gitee.com/oneww/onew_image/raw/master/kvm-diver-GUI.png" alt="images" /></p>

    <p>安装驱动<img src="./img/kvm-install-driver.png" alt="安装驱动" /></p>

    <p>安装好以后就是我们喜闻乐见的下一步下一步的安装了.值得注意是,在安装过程中,虚拟机会重启多次,如果虚拟没有自己启动,请手动重启一下.附上安装好的截图<img src="https://gitee.com/oneww/onew_image/raw/master/kvm-install-finish.png" alt="images" /></p>
  </li>
</ol>

<h1 id="四总结">四、总结</h1>

<p>安装过程还算是顺利,使用起来呢,感觉有点卡顿,不知道是不是哪里没配置好.</p>
