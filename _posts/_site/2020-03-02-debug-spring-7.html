<h1 id="一前言">一、前言</h1>

<p>​	通过前面大批量的工作,终于要到注册BeanDefinitionHolder这一步了.当然还是通过一下代码作为入口进行分析.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">processBeanDefinition</span><span class="o">(</span><span class="nc">Element</span> <span class="n">ele</span><span class="o">,</span> <span class="nc">BeanDefinitionParserDelegate</span> <span class="n">delegate</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 解析xml元素</span>
		<span class="nc">BeanDefinitionHolder</span> <span class="n">bdHolder</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">.</span><span class="na">parseBeanDefinitionElement</span><span class="o">(</span><span class="n">ele</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">bdHolder</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// 装饰bean</span>
			<span class="n">bdHolder</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">.</span><span class="na">decorateBeanDefinitionIfRequired</span><span class="o">(</span><span class="n">ele</span><span class="o">,</span> <span class="n">bdHolder</span><span class="o">);</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="c1">// Register the final decorated instance.</span>
				<span class="c1">// 注册bean到容器中</span>
				<span class="nc">BeanDefinitionReaderUtils</span><span class="o">.</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">bdHolder</span><span class="o">,</span> <span class="n">getReaderContext</span><span class="o">().</span><span class="na">getRegistry</span><span class="o">());</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">BeanDefinitionStoreException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">getReaderContext</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="s">"Failed to register bean definition with name '"</span> <span class="o">+</span>
						<span class="n">bdHolder</span><span class="o">.</span><span class="na">getBeanName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">,</span> <span class="n">ele</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="c1">// Send registration event.</span>
			<span class="c1">// 发送事件</span>
			<span class="n">getReaderContext</span><span class="o">().</span><span class="na">fireComponentRegistered</span><span class="o">(</span><span class="k">new</span> <span class="nc">BeanComponentDefinition</span><span class="o">(</span><span class="n">bdHolder</span><span class="o">));</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>​	解析、装饰都已经记录了,解析来的重点就是<code class="language-plaintext highlighter-rouge">BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());</code>这句代码了.</p>

<h1 id="二分析">二、分析</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">registerBeanDefinition</span><span class="o">(</span>
			<span class="nc">BeanDefinitionHolder</span> <span class="n">definitionHolder</span><span class="o">,</span> <span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">BeanDefinitionStoreException</span> <span class="o">{</span>
		<span class="c1">// 注册 bean</span>
		<span class="c1">// Register bean definition under primary name.</span>
		<span class="c1">// 获取 bean 的名称</span>
		<span class="nc">String</span> <span class="n">beanName</span> <span class="o">=</span> <span class="n">definitionHolder</span><span class="o">.</span><span class="na">getBeanName</span><span class="o">();</span>
		<span class="c1">// 注册</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">definitionHolder</span><span class="o">.</span><span class="na">getBeanDefinition</span><span class="o">());</span>

		<span class="c1">//注册 bean 的所有别名</span>
		<span class="c1">// Register aliases for bean name, if any.</span>
		<span class="nc">String</span><span class="o">[]</span> <span class="n">aliases</span> <span class="o">=</span> <span class="n">definitionHolder</span><span class="o">.</span><span class="na">getAliases</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">aliases</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">alias</span> <span class="o">:</span> <span class="n">aliases</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">registry</span><span class="o">.</span><span class="na">registerAlias</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">alias</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ol>
  <li>通过bean的名称进行注册</li>
  <li>通过bean的别名进行注册</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistry</code>这个对象是通过<code class="language-plaintext highlighter-rouge">XmlReaderContext</code>中获取的.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// XmlReaderContext</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="nc">BeanDefinitionRegistry</span> <span class="nf">getRegistry</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">reader</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">();</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>​	而这个reader则是<code class="language-plaintext highlighter-rouge">XmlBeanDefinitionReader</code>,<code class="language-plaintext highlighter-rouge">registry</code>对象则通过<code class="language-plaintext highlighter-rouge">XmlBeanDefinitionReader</code>的构造方法传入进来,实际上这个<code class="language-plaintext highlighter-rouge">registry</code>对象就是<code class="language-plaintext highlighter-rouge">XmlBeanFactory</code>或者说是<code class="language-plaintext highlighter-rouge">DefaultListableBeanFactory</code>,因为这两个有继承关系.</p>

<p>​	<img src="https://gitee.com/oneww/onew_image/raw/master/XmlBeanFactory.png" alt="images" /></p>

<h2 id="21-registerbeandefinition">2.1 registerBeanDefinition</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// DefaultListableBeanFactory</span>
<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerBeanDefinition</span><span class="o">(</span><span class="nc">String</span> <span class="n">beanName</span><span class="o">,</span> <span class="nc">BeanDefinition</span> <span class="n">beanDefinition</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">BeanDefinitionStoreException</span> <span class="o">{</span>

		<span class="nc">Assert</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="s">"Bean name must not be empty"</span><span class="o">);</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">beanDefinition</span><span class="o">,</span> <span class="s">"BeanDefinition must not be null"</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">beanDefinition</span> <span class="k">instanceof</span> <span class="nc">AbstractBeanDefinition</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="c1">// 校验 bean 的定义是否合法</span>
				<span class="o">((</span><span class="nc">AbstractBeanDefinition</span><span class="o">)</span> <span class="n">beanDefinition</span><span class="o">).</span><span class="na">validate</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">BeanDefinitionValidationException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">BeanDefinitionStoreException</span><span class="o">(</span><span class="n">beanDefinition</span><span class="o">.</span><span class="na">getResourceDescription</span><span class="o">(),</span> <span class="n">beanName</span><span class="o">,</span>
						<span class="s">"Validation of bean definition failed"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="c1">// 从缓存中取出 BeanDefinition</span>
		<span class="nc">BeanDefinition</span> <span class="n">existingDefinition</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
		<span class="c1">// bean 已被注册过</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">existingDefinition</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// 如果不允许重复注册则抛出异常</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">isAllowBeanDefinitionOverriding</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">BeanDefinitionOverrideException</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">,</span> <span class="n">existingDefinition</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">existingDefinition</span><span class="o">.</span><span class="na">getRole</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">beanDefinition</span><span class="o">.</span><span class="na">getRole</span><span class="o">())</span> <span class="o">{</span>
				<span class="c1">// e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Overriding user-defined bean definition for bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"' with a framework-generated bean definition: replacing ["</span> <span class="o">+</span>
							<span class="n">existingDefinition</span> <span class="o">+</span> <span class="s">"] with ["</span> <span class="o">+</span> <span class="n">beanDefinition</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="nf">if</span> <span class="o">(!</span><span class="n">beanDefinition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">existingDefinition</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Overriding bean definition for bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"' with a different definition: replacing ["</span> <span class="o">+</span> <span class="n">existingDefinition</span> <span class="o">+</span>
							<span class="s">"] with ["</span> <span class="o">+</span> <span class="n">beanDefinition</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Overriding bean definition for bean '"</span> <span class="o">+</span> <span class="n">beanName</span> <span class="o">+</span>
							<span class="s">"' with an equivalent definition: replacing ["</span> <span class="o">+</span> <span class="n">existingDefinition</span> <span class="o">+</span>
							<span class="s">"] with ["</span> <span class="o">+</span> <span class="n">beanDefinition</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="c1">// 放入到 map 中</span>
			<span class="c1">// 覆盖</span>
			<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="c1">// 判断是否有创建中的bean</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">hasBeanCreationStarted</span><span class="o">())</span> <span class="o">{</span>
				<span class="c1">// Cannot modify startup-time collection elements anymore (for stable iteration)</span>
				<span class="c1">// 加锁</span>
				<span class="c1">// 不能修改启动时的集合,需要重新创建一个集合</span>
				<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">)</span> <span class="o">{</span>
					<span class="c1">// 放入map中</span>
					<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">);</span>
					<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">updatedDefinitions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
					<span class="n">updatedDefinitions</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span><span class="o">);</span>
					<span class="n">updatedDefinitions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
					<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span> <span class="o">=</span> <span class="n">updatedDefinitions</span><span class="o">;</span>
					<span class="c1">// 如果这个已经 bean 在存在 则移除</span>
					<span class="n">removeManualSingletonName</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="c1">// Still in startup registration phase</span>
				<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">beanDefinition</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">beanDefinitionNames</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
        <span class="c1">// 如果这个已经 bean 在存在 则移除</span>
				<span class="n">removeManualSingletonName</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">this</span><span class="o">.</span><span class="na">frozenBeanDefinitionNames</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="c1">//注册成功,如果是重复注册的则销毁之前注册的bean</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">existingDefinition</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">containsSingleton</span><span class="o">(</span><span class="n">beanName</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">resetBeanDefinition</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>​	这个阶段呢,bean都还没开始创建,都是在做解析,注册之类的事情,所以这里有一个判断看起来比较迷惑<code class="language-plaintext highlighter-rouge">hasBeanCreationStarted</code>.或许后面才会知道这个判断条件有啥用吧.</p>

<ol>
  <li>验证<code class="language-plaintext highlighter-rouge">beanDefinition</code>是否合法</li>
</ol>

 	2. 判断bean是否被注册过,如果不允许重复注册则抛出异常
 	3. 如果允许重复注册则放入<code class="language-plaintext highlighter-rouge">beanDefinitionMap</code>这个map集合中
 	4. 如果该<code class="language-plaintext highlighter-rouge">beanDefinition</code>未被注册过,则添加映射到<code class="language-plaintext highlighter-rouge">beanDefinitionMap</code>中去和<code class="language-plaintext highlighter-rouge">beanDefinitionNames</code>集合中去.
 	5. 注册成功,如果是重复注册的则销毁之前注册的bean

<h2 id="22-registeralias">2.2 registerAlias</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SimpleAliasRegistry</span>
<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerAlias</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">alias</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="s">"'name' must not be empty"</span><span class="o">);</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">alias</span><span class="o">,</span> <span class="s">"'alias' must not be empty"</span><span class="o">);</span>
		<span class="c1">// 加锁 并发控制</span>
		<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// 判断 bean 名称是否与别名相同,如果相同则忽略</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">alias</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
				<span class="c1">// 移除别名</span>
				<span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">alias</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Alias definition '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' ignored since it points to same name"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="c1">// 判断别名是否已存在</span>
				<span class="nc">String</span> <span class="n">registeredName</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">alias</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">registeredName</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="c1">// 如果别名对应的bean的名称与name相同则忽略</span>
					<span class="k">if</span> <span class="o">(</span><span class="n">registeredName</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
						<span class="c1">// An existing alias - no need to re-register</span>
						<span class="k">return</span><span class="o">;</span>
					<span class="o">}</span>
					<span class="c1">// 是否允许覆盖,如果不允许则报错</span>
					<span class="k">if</span> <span class="o">(!</span><span class="n">allowAliasOverriding</span><span class="o">())</span> <span class="o">{</span>
						<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"Cannot define alias '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' for name '"</span> <span class="o">+</span>
								<span class="n">name</span> <span class="o">+</span> <span class="s">"': It is already registered for name '"</span> <span class="o">+</span> <span class="n">registeredName</span> <span class="o">+</span> <span class="s">"'."</span><span class="o">);</span>
					<span class="o">}</span>
					<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
						<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Overriding alias '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' definition for registered name '"</span> <span class="o">+</span>
								<span class="n">registeredName</span> <span class="o">+</span> <span class="s">"' with new target name '"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">);</span>
					<span class="o">}</span>
				<span class="o">}</span>
				<span class="c1">//检查是否有循环引用别名 例如:A-B C-B A-C</span>
				<span class="n">checkForAliasCircle</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">alias</span><span class="o">);</span>
				<span class="c1">//映射别名和名称到map中</span>
				<span class="k">this</span><span class="o">.</span><span class="na">aliasMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">alias</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Alias definition '"</span> <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">"' registered for name '"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ol>
  <li>判断别名是否与bean名称是否相同</li>
  <li>如果相同则移除别名</li>
  <li>判断别名是否已经存在</li>
  <li>如果不存在检查是否存在循环引用</li>
  <li>映射别名</li>
</ol>

<p>​	这里检测是否存在循环引用比较有意思,之前文章应该记录到了这块儿的逻辑.</p>

<h1 id="三小结">三、小结</h1>

<p>​	bean的解析与注册已经分析完了,接下来就是重头戏了,终于要看看 spring 是怎么根据<code class="language-plaintext highlighter-rouge">BeanDefinition</code>来创建bean对象.</p>
