I"Œm<h1 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h1>

<p>ç”±äºå…¬å¸è¦æ±‚éœ€è¦æä¾›ä¸€ä¸ªäººè„¸æ£€æµ‹çš„æ¡Œé¢è½¯ä»¶æ‰“åŒ…å‡ºå»ç”¨,ç›®å‰è™¹è½¯åœ¨è¿™å—å„¿ç®—æ˜¯åšçš„æ¯”è¾ƒçš„å¥½çš„,å¹¶ä¸”äººè„¸è¯†åˆ«ä¹Ÿæ˜¯å…è´¹,äºæ˜¯é¦–å½“å…¶å†²çš„é€‰æ‹©äº†è™¹è½¯çš„äº§å“.æ²¡ç›¸å½“ç”¨javaFXæ‰“åŒ…ä¹‹åé‡åˆ°äº†å„ç§å‘,å¿ƒç´¯å‘€.</p>

<h1 id="äºŒè¸©å‘é”¦é›†">äºŒã€è¸©å‘é”¦é›†</h1>

<ol>
  <li>
    <p>å¤šçº¿ç¨‹ä½¿ç”¨è™¹è½¯åº“çš„æ—¶å€™,å¿…é¡»æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªè™¹è½¯çš„å¼•æ“,ä¸ç„¶ä¼šæŠ¥é”™.å¦‚æœæƒ³ä½¿ç”¨çº¿ç¨‹æ± ,é¦–å…ˆç»§æ‰¿thread,åœ¨å¯¹è±¡ä¸­å°è£…è™¹è½¯çš„å¼•æ“å¯¹è±¡(è¿™é‡Œjavaä½¿ç”¨çš„æ˜¯JNA),ç„¶ååˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™,newçš„threadå¯¹è±¡ä¸€å®šæ˜¯è‡ªå·±åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡,è¿™æ ·å°±ä¿è¯äº†ä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªè™¹è½¯çš„å¯¹è±¡.è¯¦æƒ…çœ‹ä¸€ä¸‹ä»£ç :</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   
<span class="cm">/**
å°è£…FD
*/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Detection</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">FD_WORK_BUF_SIZE</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">;</span><span class="c1">// 20 MB</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">nScale</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span> <span class="c1">// æœ‰æ•ˆå€¼èŒƒå›´[2,50]</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MAX_FACE_NUM</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span> <span class="c1">// æœ‰æ•ˆå€¼èŒƒå›´[1,50]</span>
    <span class="kd">private</span> <span class="nc">Pointer</span> <span class="n">hFDEngine</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Pointer</span> <span class="n">pFDWorkMem</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">doing</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
	<span class="c1">//åœ¨æ„é€ æ–¹æ³•ä¸­,åˆå§‹åŒ–è™¹è½¯å¼•æ“</span>
    <span class="kd">public</span> <span class="nf">Detection</span><span class="o">(){</span>
        <span class="nc">String</span> <span class="no">APPID</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">String</span> <span class="no">FD_SDKKEY</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="nc">OSUtils</span><span class="o">.</span><span class="na">getCurrentOSType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">OSUtils</span><span class="o">.</span><span class="na">OSType</span><span class="o">.</span><span class="na">Windows</span><span class="o">){</span>
            <span class="no">APPID</span> <span class="o">=</span> <span class="nc">ArcFace</span><span class="o">.</span><span class="na">appid_Windows_x64</span><span class="o">;</span>
            <span class="no">FD_SDKKEY</span> <span class="o">=</span> <span class="nc">ArcFace</span><span class="o">.</span><span class="na">sdkkey_FD_Windows_x64</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="nc">OSUtils</span><span class="o">.</span><span class="na">getCurrentOSType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">OSUtils</span><span class="o">.</span><span class="na">OSType</span><span class="o">.</span><span class="na">Linux</span><span class="o">){</span>
            <span class="no">APPID</span> <span class="o">=</span> <span class="nc">ArcFace</span><span class="o">.</span><span class="na">appid_Linux_x64</span><span class="o">;</span>
            <span class="no">FD_SDKKEY</span> <span class="o">=</span> <span class="nc">ArcFace</span><span class="o">.</span><span class="na">sdkkey_FD_Linux_x64</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">pFDWorkMem</span> <span class="o">=</span> <span class="nc">CLibrary</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">malloc</span><span class="o">(</span><span class="no">FD_WORK_BUF_SIZE</span><span class="o">);</span>
        <span class="nc">PointerByReference</span> <span class="n">phFDEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PointerByReference</span><span class="o">();</span>
        <span class="nc">NativeLong</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">AFD_FSDKEngine</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">AFD_FSDK_InitialFaceEngine</span><span class="o">(</span>
                <span class="no">APPID</span><span class="o">,</span>
                <span class="no">FD_SDKKEY</span><span class="o">,</span>
                <span class="n">pFDWorkMem</span><span class="o">,</span>
                <span class="no">FD_WORK_BUF_SIZE</span><span class="o">,</span>
                <span class="n">phFDEngine</span><span class="o">,</span>
                <span class="n">FSDK_OrientPriority</span><span class="o">.</span><span class="na">FSDK_OPF_0_HIGHER_EXT</span><span class="o">,</span>
                <span class="n">nScale</span><span class="o">,</span>
                <span class="no">MAX_FACE_NUM</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ret</span><span class="o">.</span><span class="na">longValue</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">CLibrary</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">free</span><span class="o">(</span><span class="n">pFDWorkMem</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"AFD_FSDK_InitialFaceEngine ret 0x%x %s"</span><span class="o">,</span> <span class="n">ret</span><span class="o">.</span><span class="na">longValue</span><span class="o">(),</span> <span class="nc">Error</span><span class="o">.</span><span class="na">getErrorMsg</span><span class="o">(</span><span class="n">ret</span><span class="o">.</span><span class="na">longValue</span><span class="o">())));</span>
        <span class="o">}</span>
        <span class="n">hFDEngine</span> <span class="o">=</span> <span class="n">phFDEngine</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
    <span class="o">}</span>
   
    <span class="kd">public</span> <span class="nc">FaceInfo</span><span class="o">[]</span> <span class="nf">faceDetection</span><span class="o">(</span><span class="no">ASVLOFFSCREEN</span> <span class="n">inputImg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">FaceInfo</span><span class="o">[]</span> <span class="n">faceInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FaceInfo</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="nc">PointerByReference</span> <span class="n">ppFaceRes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PointerByReference</span><span class="o">();</span>
        <span class="n">doing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="nc">NativeLong</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">AFD_FSDKEngine</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">AFD_FSDK_StillImageFaceDetection</span><span class="o">(</span>
                <span class="n">hFDEngine</span><span class="o">,</span>
                <span class="n">inputImg</span><span class="o">,</span>
                <span class="n">ppFaceRes</span><span class="o">);</span>
        <span class="n">doing</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ret</span><span class="o">.</span><span class="na">longValue</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"AFD_FSDK_StillImageFaceDetection ret 0x%x %s"</span><span class="o">,</span> <span class="n">ret</span><span class="o">.</span><span class="na">longValue</span><span class="o">(),</span> <span class="nc">Error</span><span class="o">.</span><span class="na">getErrorMsg</span><span class="o">(</span><span class="n">ret</span><span class="o">.</span><span class="na">longValue</span><span class="o">())));</span>
            <span class="k">return</span> <span class="n">faceInfo</span><span class="o">;</span>
        <span class="o">}</span>
   
        <span class="no">AFD_FSDK_FACERES</span> <span class="n">faceRes</span> <span class="o">=</span> <span class="k">new</span> <span class="no">AFD_FSDK_FACERES</span><span class="o">(</span><span class="n">ppFaceRes</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">faceRes</span><span class="o">.</span><span class="na">nFace</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">faceInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FaceInfo</span><span class="o">[</span><span class="n">faceRes</span><span class="o">.</span><span class="na">nFace</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faceRes</span><span class="o">.</span><span class="na">nFace</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="no">MRECT</span> <span class="n">rect</span> <span class="o">=</span> <span class="k">new</span> <span class="no">MRECT</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pointer</span><span class="o">(</span><span class="nc">Pointer</span><span class="o">.</span><span class="na">nativeValue</span><span class="o">(</span><span class="n">faceRes</span><span class="o">.</span><span class="na">rcFace</span><span class="o">.</span><span class="na">getPointer</span><span class="o">())</span> <span class="o">+</span> <span class="n">faceRes</span><span class="o">.</span><span class="na">rcFace</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">*</span> <span class="n">i</span><span class="o">));</span>
                <span class="kt">int</span> <span class="n">orient</span> <span class="o">=</span> <span class="n">faceRes</span><span class="o">.</span><span class="na">lfaceOrient</span><span class="o">.</span><span class="na">getPointer</span><span class="o">().</span><span class="na">getInt</span><span class="o">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="o">);</span>
                <span class="n">faceInfo</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FaceInfo</span><span class="o">();</span>
                <span class="n">faceInfo</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">left</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="na">left</span><span class="o">;</span>
                <span class="n">faceInfo</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">top</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="na">top</span><span class="o">;</span>
                <span class="n">faceInfo</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">right</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="na">right</span><span class="o">;</span>
                <span class="n">faceInfo</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">bottom</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="na">bottom</span><span class="o">;</span>
                <span class="n">faceInfo</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">orient</span> <span class="o">=</span> <span class="n">orient</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">faceInfo</span><span class="o">;</span>
    <span class="o">}</span>
   
    <span class="kd">public</span> <span class="nc">FaceInfo</span><span class="o">[]</span> <span class="nf">faceDetection</span><span class="o">(</span><span class="nc">BufferedImage</span> <span class="n">img</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">faceDetection</span><span class="o">(</span><span class="nc">ArcFaceUtil</span><span class="o">.</span><span class="na">getASVLOFFSCREEN</span><span class="o">(</span><span class="n">img</span><span class="o">));</span>
    <span class="o">}</span>
   
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">(){</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">doing</span><span class="o">){</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">AFD_FSDKEngine</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">AFD_FSDK_UninitialFaceEngine</span><span class="o">(</span><span class="n">hFDEngine</span><span class="o">);</span>
            <span class="nc">CLibrary</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">free</span><span class="o">(</span><span class="n">pFDWorkMem</span><span class="o">);</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
   
   
<span class="c1">//ç»§æ‰¿çº¿ç¨‹å¯¹è±¡</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FaceThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
   
   
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Detection</span> <span class="n">detection</span><span class="o">;</span>
     
    <span class="kd">public</span> <span class="nf">FaceThread</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">runnable</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">runnable</span><span class="o">);</span>
        <span class="n">detection</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Detection</span><span class="o">();</span>
    <span class="o">}</span>
   
   
   
    <span class="kd">public</span> <span class="nc">Detection</span> <span class="nf">getDetection</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">detection</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
   
<span class="c1">//åˆ›å»ºçº¿ç¨‹æ± </span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ListeningExecutorService</span> <span class="no">FACE_THREAD_POOL</span> <span class="o">=</span> <span class="nc">MoreExecutors</span><span class="o">.</span><span class="na">listeningDecorator</span><span class="o">(</span><span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="k">new</span> <span class="nc">ThreadFactoryBuilder</span><span class="o">().</span><span class="na">setThreadFactory</span><span class="o">(</span><span class="nl">FaceThread:</span><span class="o">:</span><span class="k">new</span><span class="o">).</span><span class="na">setNameFormat</span><span class="o">(</span><span class="s">"face-%d-Thread"</span><span class="o">).</span><span class="na">setUncaughtExceptionHandler</span><span class="o">((</span><span class="n">t</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">)).</span><span class="na">setDaemon</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">build</span><span class="o">()));</span>
</code></pre></div>    </div>

    <p>ä½¿ç”¨çš„æ—¶å€™,åªéœ€è¦æ‹¿åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡,å°±å¯ä»¥äº†,å› ä¸ºå½“å‰çº¿ç¨‹å¯¹è±¡é‡Œé¢æœ‰è™¹è½¯çš„è¯†åˆ«å¼•æ“å¯¹è±¡.</p>
  </li>
  <li>
    <p>æŸäº›ç”µè„‘åŠ è½½ä¸äº†è™¹è½¯çš„dllæ–‡ä»¶</p>

    <p>è¿™ä¸ªé¦–å…ˆæ’æŸ¥è‡ªå·±ä»£ç ä¸­çš„dllè·¯å¾„æœ‰æ²¡æœ‰é”™,å¦‚æœæ²¡æœ‰é”™,å°±çœ‹åº“çš„ç‰ˆæœ¬ä¸jvmçš„ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´,å¿…é¡»ä¸¤ä¸ªéƒ½ä¸º32æˆ–è€…64æ‰èƒ½è·‘.å¦ˆçš„å¦‚æœè¿™æ—¶å€™ç‰ˆæœ¬ä¹Ÿæ˜¯ä¸€è‡´çš„,å°±çœ‹ç”µè„‘ä¸Šæ˜¯å¦å®‰è£…äº†<a href="https://www.microsoft.com/zh-CN/download/details.aspx?id=40784">vc++ 2013</a>çš„è¿è¡Œåº“,å¦‚æœæ²¡æœ‰å°±ä¸‹è½½ä¸€ä¸ªè¿›è¡Œå®‰è£….å¦‚æœè¿˜æ˜¯æ²¡åŠæ³•,é—®å®˜æ–¹å§.</p>
  </li>
  <li>
    <p>æ‰“åŒ…æˆjaråŠ è½½ä¸äº†dllæ–‡ä»¶</p>

    <p>è¿™ä¸ªçš„ç¡®æ˜¯ä¸ªé—®é¢˜,å¯¹äºä¸€ä¸ªæœ‰å¼ºè¿«ç—‡çš„äººæ¥è¯´.å› ä¸ºdllæ–‡ä»¶è¢«æ‰“åŒ…è¿›jarä¸­äº†,æ‰€ä»¥dllå°±ä¸å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­äº†,è¿™ä¸ªæ—¶å€™éœ€è¦ä»jarä¸­é‡Šæ”¾å‡ºdllæ–‡ä»¶æ¥,åœ¨è¿›è¡ŒåŠ è½½dll.ä»£ç å¦‚ä¸‹:</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @author
 * */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadUtils</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">loadOSLibrary</span><span class="o">(</span><span class="nc">String</span> <span class="n">libName</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">interfaceClass</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
            <span class="no">URI</span> <span class="n">uri</span> <span class="o">=</span> <span class="nc">LoadUtils</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getProtectionDomain</span><span class="o">().</span><span class="na">getCodeSource</span><span class="o">().</span><span class="na">getLocation</span><span class="o">().</span><span class="na">toURI</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Platform</span><span class="o">.</span><span class="na">isWindows</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="s">"arcsoft/windows_x64/"</span> <span class="o">+</span> <span class="n">libName</span> <span class="o">+</span> <span class="s">".dll"</span><span class="o">;</span>
                <span class="n">uri</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nc">Platform</span><span class="o">.</span><span class="na">isLinux</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="s">"arcsoft/linux_x64/"</span> <span class="o">+</span> <span class="n">libName</span> <span class="o">+</span> <span class="s">".so"</span><span class="o">;</span>
                <span class="n">uri</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"unsupported platform"</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="nc">Path</span> <span class="n">path</span> <span class="o">=</span> <span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
            <span class="c1">//å°è¯•é‡Šæ”¾èµ„æº</span>
            <span class="k">if</span><span class="o">(!</span><span class="nc">Files</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="n">path</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">filePath</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
                <span class="nc">Path</span> <span class="n">parent</span> <span class="o">=</span> <span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="s">"./"</span><span class="o">));</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
                <span class="c1">//çˆ¶ç›®å½•ä¸å­˜åœ¨,åˆ›å»ºç›®å½•</span>
                <span class="k">if</span><span class="o">(!</span><span class="nc">Files</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="n">parent</span><span class="o">)){</span>
                    <span class="nc">Files</span><span class="o">.</span><span class="na">createDirectories</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="nc">Files</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="nc">LoadUtils</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"/"</span> <span class="o">+</span> <span class="n">filePath</span><span class="o">),</span><span class="n">path</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="k">return</span> <span class="nf">loadLibrary</span><span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">interfaceClass</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">URISyntaxException</span> <span class="o">|</span> <span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
   
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
   
	<span class="kd">private</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">loadLibrary</span><span class="o">(</span><span class="nc">String</span> <span class="n">filePath</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">interfaceClass</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Native</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">interfaceClass</span><span class="o">);</span>
	<span class="o">}</span>
   
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä½¿ç”¨è™¹è½¯çš„ft(libarcsoft_fsdk_face_tracking.dll)å’Œfd(libarcsoft_fsdk_face_detection.dll)çš„æ•ˆæœæ˜¯ä¸ä¸€æ ·çš„.</p>

    <p>æœ€å¼€å§‹ä½¿ç”¨çš„ftè¿›è¡Œçš„äººè„¸æ£€æµ‹,å‘ç°æœ‰æ—¶å€™èƒ½æ£€æµ‹å‡ºäººè„¸è€Œæœ‰æ—¶å€™å´æ£€æµ‹ä¸å‡ºäººè„¸,å‘å•Š.æœ€åæ¢äº†fdä¹‹åè¿™ç§æƒ…å†µå°±æ²¡äº†.</p>
  </li>
</ol>

<h1 id="ä¸‰æ€»ç»“">ä¸‰ã€æ€»ç»“</h1>

<p>é¡¹ç›®ä¸æ­¢,è¸©å‘ä¸æ–­,åé¢è¸©åˆ°æ–°å‘,ä¼šè¡¥å……ä¸Šæ¥.å¿ƒç´¯â€¦â€¦</p>
:ET